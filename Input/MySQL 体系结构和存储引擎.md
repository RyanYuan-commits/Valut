---
type: input
banner: Assets/Banner/pexels-faikackmerd-1025469.jpg
---
# 📰 阅读笔记

## 1	MySQL 体系结构

辨析数据库与数据库实例:

- 数据库是文件的集合, 是依照某种数据模型组织起来并存放于二级存储器中的数据集合;
	
- 数据库实例是程序, 是位于用户和操作系统之间的一层数据管理软件, 用户对数据数据的任何操作, 包括数据库定义, 数据查询, 数据维护, 数据库运行控制都是在数据库实例下运行的, 应用程序只有通过数据库实例才能和数据库打交道.

![[MySQL 体系结构.png|800]]

**组成部分**: 连接池组件, 管理服务和工具组件, SQL 接口组件, 查询分析器组件, 优化器组件, Cache 组件, 插件式存储引擎, 物理文件.

插件式存储引擎是 MySQL 的特色, 存储引擎是基于表的.

## 2	MySQL 存储引擎

### 2.1	InnoDB 存储引擎

支持事务, 设计目标主要面向在线事务处理 OLTP 的应用;

特点是行锁设计, 支持外键, 支持非锁定读, 即默认的读取操作不会产生锁; 在 MySQL 5.5.8 版本后作为默认存储引擎.

通过 MVCC 获取并发性, 实现了 SQL 标准的四种隔离级别, 默认为 REPEATABLE, 同时, 使用 next-key locking 来避免幻读 phantom.

提供了插入缓冲 insert buffer, 二次写 double write, 自适应哈希索引 adaptive hash index, 预读 read ahead 等高性能和高可用功能

存储数据采用聚集方式, 每张表的存储会按照主键顺序存放, 如果没有显示的指定主键, 则每行生成 6 Bytes 的 ROWID 作为主键.

### 2.2	MyISAM 存储引擎

MyISAM 存储引擎不支持事务, 表锁设计, 支持全文索引, 主要面向一些 OLAP 数据应用. 是 MySQL 5.5.8 版本之前的默认存储引擎.

MyISAM 的缓冲池只缓存索引文件, 而不缓冲数据文件, 这与绝大多数数据库都非常不同.

MyISAM 存储引擎表由 MYD 和 MYI 组成, MYD用来存放数据文件, MYI用来存放索引文件. 可以通过使用myisampack工具来进一步压缩数据文件, 因为myisampack工具使用赫夫曼编码静态算法来压缩数据, 因此使用 myisampack 工具压缩后的表是只读的, 当然用户也可以通过 myisampack 来解压数据文件. 

### 2.3	NDB 存储引擎

NDB 是 MySQL 的一个集群存储引擎, 采用 share nothing 架构, 数据主要放在内存里, 通过增加数据节点可以线性提升性能, 适合高可用和高性能的场景.

NDB 的 JOIN 运算是在 MySQL 服务器层而不是存储引擎内部完成, 复杂连接会导致很大的网络开销, 从而使查询速度偏慢, 这是一个重要局限. 

NDB Cluster 提供社区版和企业版, 可以作为单独产品下载并获取最新版本用于部署.

### 2.4	Memory 存储引擎

之前称 HEAP 存储引擎, 将表中的数据存储在内存中, 数据库重启或崩溃会导致数据的小孩,  非常适合用于存储临时数据的临时表, 以及数据仓库中的纬度表;

默认使用哈希索引;

只支持表锁, 并发性能较差, 不支持 TEXT 和 BLOB 列类型, 存储 varchar 时是按照定长字段的方式进行的, 因此会浪费内存.

MySQL 使用 Memory 存储引擎作为临时表来存放查询的中间结果集, 如果结果集大于 Memory 的容量, 又或者含有 TEXT 或者 BLOB 列类型的字段, MySQL 会将其转换到 MyISAM 存储引擎表, 然后存放到磁盘; MyISAM 不缓存数据文件, 因此这是产生的临时表的性能对于查询会有所损失.

### 2.5	Archive 存储引擎是基于表的

只支持 INSERT 和 SELECT 操作, 从 MySQL 5.1 开始支持索引, 使用 zlib 将数据行进行压缩后存储, 压缩比可以达到 1:10;

非常适合归档数据, 如日志信息;

使用行锁实现高并发插入操作, 但是本身事务不安全, 设计目标是提供高速插入和压缩功能.

### 2.6	Federated 存储引擎

不存放数据, 是指向远程 MySQL 服务器上的表, 用来在本地库直接访问另一台 MySQL 的表数据, 类似 SQL Server 的连接服务器和 Oracle 的透明网关.

### 2.7	Maria 存储引擎

Maria 存储引擎是新开发的引擎, 设计目标主要是用来取代原有的 MyISAM 存储引擎, 从而成为 MySQL 的默认存储引擎. 

可以看做是 MyISAM 的后续版本. Maria 存储引擎的特点是: 支持缓存数据和索引文件, 应用了行锁设计, 提供了 MVCC 功能, 支持事务和非事务安全的选项, 以及更好的 BLOB 字符类型的处理性能.

## 3	存储引擎性能对比

以下是表格内容的中文翻译：

| 特性         | MyISAM | Memory | InnoDB | Archive | NDB |
| ---------- | ------ | ------ | ------ | ------- | --- |
| 存储限制       | 否      | 否      | 是      | 64TB    | 是   |
| 事务（提交、回滚等） | ✔      | ✔      | ✔      | ✔       | ✔   |
| 锁定粒度       | 表      | 页      | 行      | 行       | 行   |
| MVCC/快照读   | ✔      | ✔      | ✔      | ✔       | ✔   |
| 地理空间支持     | ✔      | ✔      | ✔      | ✔       | ✔   |
| B-Tree索引   | ✔      | ✔      | ✔      | ✔       | ✔   |
| 哈希索引       | ✔      | ✔      | ✔      | ✔       | ✔   |
| 全文搜索索引     | ✔      | ✔      | ✔      | ✔       | ✔   |
| 聚簇索引       | ✔      | ✔      | ✔      | ✔       | ✔   |
| 数据缓存       | ✔      | ✔      | ✔      | ✔       | ✔   |
| 压缩数据       | ✔      | ✔      | ✔      | ✔       | ✔   |
| 加密数据（通过函数） | ✔      | ✔      | ✔      | ✔       | ✔   |
| 存储成本（空间使用） | 低      | 低      | 高      | 非常低     | 低   |
| 内存成本       | 低      | 低      | 中      | 高       | 高   |
| 内置插入速度     | 高      | 高      | 低      | 非常低     | 高   |
| 集群数据库支持    | ✔      | ✔      | ✔      | ✔       | ✔   |
| 复制支持       | ✔      | ✔      | ✔      | ✔       | ✔   |
| 备份点即时恢复    | ✔      | ✔      | ✔      | ✔       | ✔   |
| 外键支持       | ✔      | ✔      | ✔      | ✔       | ✔   |
| 查询缓存支持     | ✔      | ✔      | ✔      | ✔       | ✔   |
| 更新数据字典统计   | ✔      | ✔      | ✔      | ✔       | ✔   |

## 4	连接 MySQL

连接 MySQL 的操作是将一个连接进程和 MySQL 数据库进行通信, 从程序设计的角度来说, 本质是进程通信.

### 4.1	TCP/IP

是 MySQL 在任何平台下都提供的连接方式;

通过 TCP/IP 连接到 MySQL 实例时, MySQL 会先检查一张权限视图, 用来判断发起请求的 IP 是否允许连接到 MySQL 实例, 这个视图在 mysql 架构下, 表名为 user.

### 4.2	命名管道和存储内存

在 Windows 2000、Windows XP、Windows 2003 和 Windows Vista 以及在此之上的平台上, 如果两个需要进程通信的进程在同一台服务器上, 那么可以使用命名管道, Microsoft SQL Server 数据库默认安装后的本地连接也是使用命名管道. 

在MySQL数据库中须在配置文件中启用 --enable-named-pipe 选项. 在 MySQL 4.1 之后的版本中, MySQL还提供了共享内存的连接方式, 这是通过在配置文件中添加 --shared-memory 实现的. 如果想使用共享内存的方式, 在连接时, MySQL 客户端还必须使用 --protocol=memory 选项

### 4.3	UNIX 域套接字

在 Linux 和 UNIX 环境下, 还可以使用 UNIX 域套接字. UNIX 域套接字其实不是一个网络协议, 所以只能在 MySQL 客户端和数据库实例在一台服务器上的情况下使用. 用户可以在配置文件中指定套接字文件的路径, 如 --socket=/tmp/mysql.sock. 



---

# 💭 我的思考

这个观点如何与我已知的知识产生联系? 它让我想到了什么?